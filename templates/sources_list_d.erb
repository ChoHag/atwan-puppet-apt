# This file is automatically generated by puppet. Manual changes will be lost.

<% if @repositories.is_a? Array                                     -%>
<%   if not @url or @url == 'UNDEFINED' or @sections.empty? then    -%>
<%     fail('Cannot define apt sources in shortened list form without default URL and sections') -%>
<%   else                                                           -%>
<%     @repositories.each do | name |                               -%>
# <%= name %>
deb <%= @url %> <%= name %> <%= @sections.join(' ') %>
<%       if @source then                                            -%>
deb-src <%= @url %> <%= name %> <%= @sections.join(' ') %>
<%       end                                                        -%>

<%     end                                                          -%>
<%   end                                                            -%>
<% -%>
<% -%>
<% elsif @repositories.is_a? Hash                                   -%>
<%   @repositories.each_pair do | name, repo |                      -%>
<%     if defined? repo and repo then                               -%>
<%       if repo.is_a? String or repo.is_a? Array then              -%>
<%         repo = { 'sections' => repo }                            -%>
<%       elsif not repo.is_a? Hash then                             -%>
<%         fail("Unknown repository data type for #{name}")         -%>
<%       end                                                        -%>
<%     else                                                         -%>
<%       repo = { }                                                 -%>
<%     end                                                          -%>
<%     if repo.has_key? 'url' then                                  -%>
<%       url = repo['url']                                          -%>
<%     else                                                         -%>
<%       if @url != 'UNDEFINED' then                                -%>
<%         url = @url                                               -%>
<%       else                                                       -%>
<%         fail('No default URL defined')                           -%>
<%       end                                                        -%>
<%     end                                                          -%>
<% -%>
<%     if repo.has_key? 'suite' then                                -%>
<%       suite = repo['suite']                                      -%>
<%     else                                                         -%>
<%       if @suite != 'UNDEFINED' then                              -%>
<%         suite = @suite                                           -%>
<%       else                                                       -%>
<%         fail('No default suite defined')                         -%>
<%       end                                                        -%>
<%     end                                                          -%>
<% -%>
<%     if repo.has_key? 'sections' then                             -%>
<%       sections = [repo['sections']].flatten                      -%>
<%     else                                                         -%>
<%       if not @sections.empty?                                    -%>
<%         sections = @sections                                     -%>
<%       else                                                       -%>
<%         fail('No default sections defined')                      -%>
<%       end                                                        -%>
<%     end                                                          -%>
<% -%>
# <%= name %>
deb <%= url %> <%= suite %> <%= sections.join(' ') %>
<%     if repo['source'] or @source then                            -%>
deb-src <%= url %> <%= suite %> <%= sections.join(' ') %>
<%     end                                                          -%>

<%   end                                                            -%>
<% -%>
<% -%>
<% else                                                             -%>
<%   fail('Unknown @repositories data type')                        -%>
<% end                                                              -%>
